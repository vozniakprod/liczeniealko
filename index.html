<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Liczenie alkoholu</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .item-row { gap: .5rem; }
    .item-name { max-width: 60%; }
    input.counter-input { font-size: 16px; }
    .table-wrap { overflow-x: auto; }
    button:focus, input:focus { outline: none !important; box-shadow: none !important; }
    .dec-btn, .inc-btn { touch-action: manipulation; -ms-touch-action: manipulation; }
    input.counter-input::-webkit-outer-spin-button, input.counter-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .modal-bg { background: rgba(0,0,0,0.5); position: fixed; inset: 0; display: flex; justify-content: center; align-items: center; }
    .modal { background: #fff; padding: 1rem; border-radius: 0.5rem; max-height: 80vh; overflow-y: auto; width: 90%; max-width: 400px; }
  </style>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-md mx-auto bg-white p-4 rounded-lg shadow">
    <h1 class="text-2xl font-bold mb-4 text-center">Liczenie alkoholu</h1>

    <div class="flex justify-between mb-2">
      <button id="openSettings" class="px-3 py-2 bg-gray-600 text-white rounded">Ustawienia</button>
    </div>

    <div id="accordion" class="divide-y divide-gray-200"></div>

    <div class="mt-6 table-wrap">
      <h2 class="text-xl font-semibold mb-2">PODSUMOWANIE</h2>
      <table class="min-w-full divide-y divide-gray-200 text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-3 py-2 text-left font-medium">Alkohol</th>
            <th class="px-3 py-2 text-right font-medium">Łącznie</th>
          </tr>
        </thead>
        <tbody id="total-tbody" class="bg-white divide-y divide-gray-100"></tbody>
      </table>
      <button id="copyNumbers" class="mt-3 px-4 py-2 bg-blue-600 text-white rounded-lg">Kopiuj liczby do Excela</button>
    </div>

    <button id="clearStorage" class="mt-6 w-full px-4 py-2 bg-red-600 text-white rounded-lg">Wyczyść dane</button>
  </div>

  <div id="settingsModal" class="modal-bg hidden">
    <div class="modal">
      <h2 class="text-lg font-bold mb-2">Ustawienia wyświetlania</h2>
      <div id="settingsContent" class="space-y-2"></div>
      <div class="mt-4 flex justify-end">
        <button id="closeSettings" class="px-3 py-2 bg-gray-600 text-white rounded">Zamknij</button>
      </div>
    </div>
  </div>

  <script>
    const locations = ["Bar 0","Bar 2","Gold","Bar Alkoholowy","Pomieszczenie koordynatorskie"];
    const items = [
      "Eisberg Sauvignon Blanc","Ferejean","Jean de la fontane","Val d oca Prosecco Brut","Solaris Białe Skały",
      "Twin Vines Verde","Crama Regala Chardonnay","Hugel","Solaris X","Lipowiec","Malborough Sun",
      "Szlachetny Zbiór turnau","Purcari Freedom Blend","Vinaria Din Vale Feteasca Neagra","Almarosa Primitivo",
      "The Gaucho","Finca Museum Crianza","Kendermann Pinot Noir","Sexton","Soutern Comfort","Famous Grouse",
      "Famous Grouse Ruby","Loch Lomond Original Single Malt","Glen Moray 12yo","Bushmills 10yo","Bushmills","Evan Williams",
      "Buffalo Trace Bourbon","Gautier VS Cognac","Soberano Reserva 5YO","Jose Cuervo Reposado Gold","Jose Cuervo Silver",
      "Kraken","Negrita White","Porto LBV Grahams","Gunpowder","Gibson's London Dry","J.A Baczewski Monopolowa",
      "J.A Baczewski Morelówka","J.A Baczewski Wiśniówka","Krupnik Cappucino","Krupnik pistacja","Bottega Fior de Latte",
      "Bottega Bitter","Carolans","Martini Bianco","Cydr","Żywiec","Heineken","Iquana","Trybunał Export",
      "Trybunał 0%","Trybunał 0% Lemon"
    ];

    let data = JSON.parse(localStorage.getItem("alcoData")) || {};
    let settings = JSON.parse(localStorage.getItem("alcoSettings")) || {};

    function saveData() { localStorage.setItem("alcoData", JSON.stringify(data)); }
    function saveSettings() { localStorage.setItem("alcoSettings", JSON.stringify(settings)); renderAccordion(); }

    function updateTotal() {
      const tbody = document.getElementById('total-tbody');
      tbody.innerHTML = '';
      items.forEach(item => {
        let sum = 0;
        locations.forEach(loc => { sum += (data[loc]?.[item] || 0); });
        const tr = document.createElement('tr');
        tr.innerHTML = `<td class=\"px-3 py-2 text-sm\">${item}</td><td class=\"px-3 py-2 text-sm text-right\">${sum}</td>`;
        tbody.appendChild(tr);
      });
    }

    function togglePanel(id) {
      const panel = document.getElementById(id);
      if(panel) panel.classList.toggle('hidden');
    }

    function renderAccordion() {
      const accordion = document.getElementById('accordion');
      accordion.innerHTML = '';
      locations.forEach((loc,i)=>{
        if(!data[loc]) data[loc]={};
        if(!Array.isArray(settings[loc])) settings[loc] = [...items];
        const itemId = `loc-${i}`;
        const section = document.createElement('div');
        section.className = 'py-1';
        section.innerHTML = `<h2><button type=\"button\" class=\"flex w-full items-center justify-between p-3 text-left font-medium\">${loc}</button></h2><div id=\"${itemId}\" class=\"hidden p-2\"><ul class=\"space-y-2\"></ul></div>`;
        accordion.appendChild(section);
        const list = section.querySelector('ul');
        items.forEach((item,j)=>{
          if(!Array.isArray(settings[loc]) || !settings[loc].includes(item)) return;
          if(typeof data[loc][item]!=='number') data[loc][item]=0;
          const inputId = `q-${i}-${j}`;
          const li = document.createElement('li');
          li.className = 'item-row flex items-center justify-between';
          li.innerHTML = `<span class=\"item-name text-sm\">${item}</span><div class=\"relative flex items-center max-w-[8rem]\"><button type=\"button\" data-dec=\"${inputId}\" class=\"dec-btn bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded-s-lg p-3 h-11\">-</button><input type=\"text\" id=\"${inputId}\" class=\"counter-input bg-gray-50 border-x-0 border-gray-300 h-11 text-center w-16\" value=\"${data[loc][item]}\"><button type=\"button\" data-inc=\"${inputId}\" class=\"inc-btn bg-gray-100 hover:bg-gray-200 border border-gray-300 rounded-e-lg p-3 h-11\">+</button></div>`;
          const decBtn = li.querySelector(`[data-dec=\"${inputId}\"]`);
          const incBtn = li.querySelector(`[data-inc=\"${inputId}\"]`);
          const inputEl = li.querySelector('input');
          decBtn.addEventListener('click',()=>{inputEl.value=Math.max(0,(parseInt(inputEl.value)||0)-1);data[loc][item]=parseInt(inputEl.value)||0;saveData();updateTotal();});
          incBtn.addEventListener('click',()=>{inputEl.value=(parseInt(inputEl.value)||0)+1;data[loc][item]=parseInt(inputEl.value)||0;saveData();updateTotal();});
          inputEl.addEventListener('input',()=>{inputEl.value=Math.max(0,parseInt(inputEl.value)||0);data[loc][item]=parseInt(inputEl.value)||0;saveData();updateTotal();});
          list.appendChild(li);
        });
        section.querySelector('button').addEventListener('click',()=>togglePanel(itemId));
      });
      updateTotal();
    }

    document.addEventListener('DOMContentLoaded',()=>{renderAccordion();});

    document.getElementById('clearStorage').addEventListener('click',()=>{localStorage.removeItem('alcoData');data={};renderAccordion();});

    document.getElementById('copyNumbers').addEventListener('click',()=>{
      const numbers = Array.from(document.querySelectorAll('#total-tbody td:nth-child(2)')).map(td=>td.textContent);
      const csv = numbers.join('\n');
      const textarea = document.createElement('textarea');
      textarea.value = csv;
      document.body.appendChild(textarea);
      textarea.select();
      try { document.execCommand('copy'); alert('Skopiowano liczby do Excela'); } catch(e){ alert('Skopiuj ręcznie: ' + csv); }
      document.body.removeChild(textarea);
    });

    // Settings modal logic
    const modal = document.getElementById('settingsModal');
    const settingsContent = document.getElementById('settingsContent');
    document.getElementById('openSettings').addEventListener('click',()=>{
      settingsContent.innerHTML = '';
      locations.forEach(loc=>{
        if(!Array.isArray(settings[loc])) settings[loc] = [...items];
        const locDiv = document.createElement('div');
        locDiv.innerHTML = `<strong>${loc}</strong>`;
        items.forEach(item=>{
          const id = `chk-${loc}-${item}`;
          const checked = settings[loc].includes(item) ? 'checked' : '';
          const cb = document.createElement('div');
          cb.innerHTML = `<label><input type=\"checkbox\" id=\"${id}\" ${checked}/> ${item}</label>`;
          locDiv.appendChild(cb);
          cb.querySelector('input').addEventListener('change',(e)=>{
            if(e.target.checked){
              if(!settings[loc].includes(item)) settings[loc].push(item);
            } else {
              settings[loc] = settings[loc].filter(it=>it!==item);
            }
            saveSettings();
          });
        });
        settingsContent.appendChild(locDiv);
      });
      modal.classList.remove('hidden');
    });

    document.getElementById('closeSettings').addEventListener('click',()=>{modal.classList.add('hidden');});
  </script>
</body>
</html>
